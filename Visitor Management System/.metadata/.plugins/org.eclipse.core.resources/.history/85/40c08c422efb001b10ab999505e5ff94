package com.manage.system.controller;

import java.text.SimpleDateFormat;
import java.util.Date;

import org.springframework.security.core.context.SecurityContextHolder;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.servlet.ModelAndView;

import com.manage.system.dto.ApplicationDTO;
import com.manage.system.service.ApplicationService;

import lombok.RequiredArgsConstructor;

@Controller
@RequiredArgsConstructor
public class UserController {
	
	private final ApplicationService applicationService;

	@GetMapping("apply")
	public ModelAndView application() {
		ModelAndView mv = new ModelAndView("index");
		mv.addObject("data", "application");
		mv.addObject("user_id", SecurityContextHolder.getContext().getAuthentication().getName());
		mv.addObject("applicationDTO", new ApplicationDTO());
//		model.addAttribute("applicationDTO", new ApplicationDTO());
		return mv;
	}
	@PostMapping("apply")
	public String apply(ApplicationDTO applicationDTO) {
		applicationDTO.setVisit_date(UtilDateToSqlDate(applicationDTO.getVisit_date())); 
		applicationDTO.setApplication_date(UtilDateToSqlDate(new Date()));
		applicationService.registerApplication(applicationDTO);
		return "uApplyDetail/";
	}
	@RequestMapping("uApplyDetail")
	public ModelAndView uApplyDetail(Model model, Integer application_num) {
		ModelAndView mv = new ModelAndView("index");
		mv.addObject("data", "user_application_detail");
		mv.addObject("List", applicationService.getApplication(application_num));
		return mv;
	}
	@RequestMapping("uDetail/{application_num}")
	public ModelAndView uDetail() {
		ModelAndView mv = new ModelAndView("index");
		mv.addObject("data", "uDetail");
		mv.addObject("application", "");
		return mv;
	} 
	Date UtilDateToSqlDate(Date date) {
		SimpleDateFormat simpleDateFormat = new SimpleDateFormat("yyyy-MM-dd");
		java.sql.Date sqldate =java.sql.Date.valueOf(simpleDateFormat.format(date));
		return sqldate;
	}
}
